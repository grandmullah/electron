<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIXOLON Thermal Printer Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 30px; }
        .status { padding: 15px; margin: 15px 0; border-radius: 5px; }
        .status.connected { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.disconnected { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .status.warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 12px 24px; margin: 8px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 14px; }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .log { background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: monospace; max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; }
        .printer-info { background: #e7f3ff; padding: 15px; border-radius: 5px; border: 1px solid #b3d9ff; }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñ®Ô∏è BIXOLON Thermal Printer Test</h1>
            <p>Testing integration with BIXOLON Web Print SDK V2.2.1+</p>
        </div>

        <div id="status" class="status warning">
            <h3>‚è≥ Checking BIXOLON SDK Status...</h3>
            <p>Please wait while we detect your BIXOLON thermal printer...</p>
        </div>

        <div class="printer-info">
            <h3>üìã Expected Configuration</h3>
            <ul>
                <li><strong>SDK:</strong> BIXOLON Web Print SDK V2.2.1</li>
                <li><strong>Printer:</strong> Bixolon SRP-350III (from your screenshot)</li>
                <li><strong>Logical Name:</strong> Printer1</li>
                <li><strong>Paper:</strong> 80mm Thermal</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>üß™ Test Controls</h3>
            <button onclick="checkSDKStatus()">Check SDK Status</button>
            <button onclick="testConnection()">Test Connection</button>
            <button onclick="testPrintJob()">Test Print Job</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>

        <div class="test-section">
            <h3>üìù Test Log</h3>
            <div id="log" class="log"></div>
        </div>
    </div>

    <!-- Load BIXOLON integration scripts -->
    <script type="text/javascript" src="js/bGateWebPrintAPI_WS.js"></script>
    <script type="text/javascript" src="js/thermal-printer-simulator.js"></script>

    <script>
        let apiInstance = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logEntry.className = type;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = `<h3>${message}</h3>`;
        }

        function checkSDKStatus() {
            log('üîç Checking BIXOLON SDK Status...', 'info');
            
            // Check for BIXOLON SDK in global scope
            const sdkNames = ['BixolonWebPrintSDK', 'BixolonWebPrint', 'bixolon', 'webprint'];
            const foundSDK = sdkNames.find(name => window[name]);
            
            if (foundSDK) {
                log(`‚úÖ Found BIXOLON SDK: ${foundSDK}`, 'success');
                log(`üì¶ SDK Object: ${typeof window[foundSDK]}`, 'info');
                log(`üîß SDK Methods: ${Object.keys(window[foundSDK] || {}).join(', ')}`, 'info');
            } else {
                log('‚ùå BIXOLON SDK not found in global scope', 'error');
                log('üí° Make sure BIXOLON Web Print SDK is running and accessible', 'info');
            }

            // Check our API instance
            if (window.bGateWebPrintAPI) {
                log('‚úÖ Our BIXOLON API wrapper is available', 'success');
                apiInstance = window.bGateWebPrintAPI;
                
                const status = apiInstance.getStatus();
                log(`üìä API Status: ${JSON.stringify(status)}`, 'info');
                
                if (status.connected) {
                    updateStatus('‚úÖ Connected to BIXOLON Thermal Printer', 'connected');
                } else {
                    updateStatus('‚ö†Ô∏è BIXOLON Printer Not Connected', 'warning');
                }
            } else {
                log('‚ùå Our BIXOLON API wrapper not found', 'error');
                updateStatus('‚ùå BIXOLON API Not Available', 'disconnected');
            }
        }

        function testConnection() {
            log('üîå Testing BIXOLON Connection...', 'info');
            
            if (!apiInstance) {
                log('‚ùå No API instance available. Run "Check SDK Status" first.', 'error');
                return;
            }

            try {
                apiInstance.connect('Printer1').then(connected => {
                    if (connected) {
                        log('‚úÖ Successfully connected to BIXOLON printer', 'success');
                        updateStatus('‚úÖ Connected to BIXOLON Thermal Printer', 'connected');
                    } else {
                        log('‚ùå Failed to connect to BIXOLON printer', 'error');
                        updateStatus('‚ùå Failed to Connect to BIXOLON Printer', 'disconnected');
                    }
                }).catch(error => {
                    log(`‚ùå Connection error: ${error.message}`, 'error');
                    updateStatus('‚ùå Connection Error', 'disconnected');
                });
            } catch (error) {
                log(`‚ùå Connection test failed: ${error.message}`, 'error');
            }
        }

        function testPrintJob() {
            log('üñ®Ô∏è Testing BIXOLON Print Job...', 'info');
            
            if (!apiInstance) {
                log('‚ùå No API instance available. Run "Check SDK Status" first.', 'error');
                return;
            }

            if (!apiInstance.connected) {
                log('‚ùå Not connected to BIXOLON printer. Run "Test Connection" first.', 'error');
                return;
            }

            try {
                const printJob = apiInstance.createPrintJob({
                    width: 80,
                    fontSize: 11,
                    fontFamily: 'monospace',
                    lineSpacing: 1.2,
                    margin: 0
                });

                log('‚úÖ Print job created successfully', 'success');

                // Add test content
                printJob.addText('BETZONE TEST RECEIPT');
                printJob.addLineBreak();
                printJob.addSeparator('=');
                printJob.addText('Date: ' + new Date().toLocaleString());
                printJob.addText('Test: BIXOLON Integration');
                printJob.addLineBreak();
                printJob.addSeparator('=');
                printJob.addText('This is a test print job');
                printJob.addText('via BIXOLON Web Print SDK');
                printJob.addLineBreak();
                printJob.addText('Thank you for testing!');

                log('‚úÖ Content added to print job', 'success');

                // Execute the print job
                printJob.execute().then(result => {
                    log(`‚úÖ Print job completed: ${JSON.stringify(result)}`, 'success');
                }).catch(error => {
                    log(`‚ùå Print job failed: ${error.message}`, 'error');
                });

            } catch (error) {
                log(`‚ùå Print job test failed: ${error.message}`, 'error');
            }
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            log('üßπ Log cleared', 'info');
        }

        // Auto-check status when page loads
        window.addEventListener('load', () => {
            log('üöÄ Page loaded, checking BIXOLON SDK status...', 'info');
            setTimeout(checkSDKStatus, 1000);
        });
    </script>
</body>
</html>
